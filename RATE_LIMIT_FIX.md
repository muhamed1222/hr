# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Rate Limiting

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –æ—à–∏–±–∫–∏:
```
Failed to load resource: the server responded with a status of 429 (Too Many Requests)
```

## üîç –ü—Ä–∏—á–∏–Ω–∞
Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω –æ—á–µ–Ω—å —Å—Ç—Ä–æ–≥–æ –¥–ª—è production:
- **–¢–æ–ª—å–∫–æ 5 –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞ –∑–∞ 15 –º–∏–Ω—É—Ç** –Ω–∞ `/api/auth/login`
- –≠—Ç–æ —Ö–æ—Ä–æ—à–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–æ –º–µ—à–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `src/routes/auth.js`
```javascript
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: process.env.NODE_ENV === 'production' ? 5 : 50, // 5 –¥–ª—è production, 50 –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  message: {
    success: false,
    message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.'
  },
  standardHeaders: true,
  legacyHeaders: false,
});
```

### 2. –£–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—é:
- **Production:** 5 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 15 –º–∏–Ω—É—Ç (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
- **Development:** 50 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 15 –º–∏–Ω—É—Ç (—É–¥–æ–±–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend:
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å
pkill -f "node src/app.js"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
npm start
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –¢–µ—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ–ª—å—à–µ –Ω–µ—Ç –æ—à–∏–±–æ–∫ 429
fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ username: 'test', password: 'test' })
}).then(r => console.log('Status:', r.status))
```

### Health check:
```bash
curl http://localhost:3000/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"status": "OK", "environment": "development"}
```

## üéØ –î–ª—è production

–í production –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
```bash
export NODE_ENV=production
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–≥–∏–µ –ª–∏–º–∏—Ç—ã (5 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 15 –º–∏–Ω—É—Ç).

## üìä –î—Ä—É–≥–∏–µ –ª–∏–º–∏—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ

### –û–±—â–∏–π API –ª–∏–º–∏—Ç–µ—Ä (src/app.js):
```javascript
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 –º–∏–Ω—É—Ç
  max: 100 // 100 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–¥–Ω–æ–≥–æ IP
});
```

### Telegram Bot –ª–∏–º–∏—Ç—ã:
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã Telegram API
- –û–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## üîÑ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–∏–º–∏—Ç–æ–≤

–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞–∂—É—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤:
```bash
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/access.log
```

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –≤ dev:
```javascript
const loginLimiter = process.env.NODE_ENV === 'production' 
  ? rateLimit({ windowMs: 15 * 60 * 1000, max: 5 })
  : (req, res, next) => next(); // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤ dev
```

### –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ IP –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```javascript
const loginLimiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: process.env.NODE_ENV === 'production' ? 5 : 50,
  skip: (req) => {
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º localhost –≤ development
    return process.env.NODE_ENV === 'development' && 
           (req.ip === '127.0.0.1' || req.ip === '::1');
  }
});
``` 